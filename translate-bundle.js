(()=>{"use strict";const t=0,e=3,a=4,n=6,r=7;function i(i,o,l,d,c){let h="https://mimir2.vivaldi.com/api/translate";function v(t){if(t instanceof Response)return t.json();throw new Error("JSON Conversion error")}if(d&&(h=d),0===l.length)return;const u=performance.now();fetch(h,{method:"POST",headers:{Accept:"application/json","Content-type":"application/json"},body:s(i,o,l)}).then((function(t){return t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(t)})).then(v).then((e=>{const a={error:!1,errorCode:t,sourceLang:e.detectedSourceLanguage,startTime:u,endTime:performance.now()};c(a,e)})).catch((t=>{const i={error:!0,errorCode:n,sourceLang:"",startTime:u,endTime:performance.now()};v(t).then((t=>{console.error("Translate failed, error: "+t.code),i.errorCode=function(t){switch(t){case"LANGUAGE_NOT_RECOGNIZED":return e;case"INVALID_LANG_CODE":return a;case"TIMEOUT_ERROR":return r;default:return n}}(t.code),c(i)})).catch((()=>{console.error("Translate request failed: ",t.statusText),c(i)}))}))}function s(t,e,a){const n={target:e||"en",q:a};return t&&(n.source=t),JSON.stringify(n)}const o="data-vivaldi-translated",l="A:not([data-vivaldi-translated]),ARTICLE:not([data-vivaldi-translated]),ASIDE:not([data-vivaldi-translated]),B:not([data-vivaldi-translated]),BLOCKQUOTE:not([data-vivaldi-translated]),BODY:not([data-vivaldi-translated]),BR:not([data-vivaldi-translated]),BUTTON:not([data-vivaldi-translated]),CAPTION:not([data-vivaldi-translated]),CITE:not([data-vivaldi-translated]),COL:not([data-vivaldi-translated]),DD:not([data-vivaldi-translated]),DIV:not([data-vivaldi-translated]),DT:not([data-vivaldi-translated]),EM:not([data-vivaldi-translated]),FIGCAPTION:not([data-vivaldi-translated]),FONT:not([data-vivaldi-translated]),H1:not([data-vivaldi-translated]),H2:not([data-vivaldi-translated]),H3:not([data-vivaldi-translated]),H4:not([data-vivaldi-translated]),H5:not([data-vivaldi-translated]),H6:not([data-vivaldi-translated]),I:not([data-vivaldi-translated]),INPUT:not([data-vivaldi-translated]),IMG:not([data-vivaldi-translated]),LABEL:not([data-vivaldi-translated]),LI:not([data-vivaldi-translated]),OPTGROUP:not([data-vivaldi-translated]),OPTION:not([data-vivaldi-translated]),P:not([data-vivaldi-translated]),PRE:not([data-vivaldi-translated]),RB:not([data-vivaldi-translated]),RT:not([data-vivaldi-translated]),RUBY:not([data-vivaldi-translated]),SECTION:not([data-vivaldi-translated]),SMALL:not([data-vivaldi-translated]),SPAN:not([data-vivaldi-translated]),STRONG:not([data-vivaldi-translated]),SUB:not([data-vivaldi-translated]),SUMMARY:not([data-vivaldi-translated]),SUP:not([data-vivaldi-translated]),TBODY:not([data-vivaldi-translated]),TD:not([data-vivaldi-translated]),TEXTAREA:not([data-vivaldi-translated]),TFOOT:not([data-vivaldi-translated]),TH:not([data-vivaldi-translated]),THEAD:not([data-vivaldi-translated]),TITLE:not([data-vivaldi-translated]),TR:not([data-vivaldi-translated]),TSPAN:not([data-vivaldi-translated])",d=["CODE","SCRIPT"],c=1,h=2,v=4,u=8,T=16,g=32;class m{isTranslated_=!1;originalAlts=new Map;originalLabels=new Map;originalNodeValues=new Map;originalPlaceholders=new Map;originalTitles=new Map;originalValues=new Map;startTime_=0;endTime_=0;startServerConnectFunction_;constructor(e=document){this.error_=!1,this.errorCode_=t,this.sourceLang_="en",this.targetLang_="",this.document_=e,this.maxTextLength_=1500,this.startServerConnectFunction_=i,this.overrideServer_="$OVERRIDE_TRANSLATE_SERVER",window.addEventListener("scroll",this.onDOMEventTranslate),this.observer=new MutationObserver(this.onDOMEventTranslate),this.observer.observe(document,{subtree:!0,childList:!0})}destructor(){window.removeEventListener("scroll",this.onDOMEventTranslate),this.observer.disconnect()}get isTranslated(){return this.isTranslated_}get error(){return this.error_}get errorCode(){return this.errorCode_}get sourceLang(){return this.sourceLang_}startTranslate(t,e){return this.isTranslated_&&this.revert(),this.targetLang_=e,this.startTranslateInternal(t,e)}revert(){this.revertInternal()}translationTime(){return Math.round(100*(this.endTime_-this.startTime_))/100}iOSSetupResultCallback(){this.resultCallback=()=>{try{const t=window.webkit;delete window.webkit,window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.TranslateMessage.postMessage({command:"status",errorCode:this.errorCode,pageSourceLanguage:this.sourceLang,translationTime:w.googleTranslate.translationTime}),window.webkit=t}catch(t){}};const t=window.webkit;delete window.webkit,window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.TranslateMessage.postMessage({command:"ready",errorCode:0,loadTime:0,readyTime:0}),window.webkit=t}onDOMEventTranslate=()=>{this.timeout_&&clearTimeout(this.timeout_),this.timeout_=setTimeout((()=>{this.observer.disconnect(),this.continueTranslateInternal()}),300)};isElementPartiallyInViewport(t){const e=t.getBoundingClientRect(),a=t?.checkVisibility(),n=window.innerHeight||this.document_.documentElement?.clientHeight,r=window.innerWidth||this.document_.documentElement?.clientWidth,i=e.top-n,s=e.height+2*n,o=i<=n&&i+s>=0,l=e.left<=r&&e.left+e.width>=0;return o&&l&&a}trimWhitespace(t){return t.trim().replace(/[\r\n\u0085\u2028\u2029\u00AD]+/g,"").replace(/(?: {2,}|\xa0)/g," ")}convertSpecialSequences(t){return(t=t.replaceAll("&nbsp;",String.fromCharCode(160))).replaceAll("&amp;",String.fromCharCode(38))}processNodes(t){const{HTMLElement:e,HTMLImageElement:a,HTMLInputElement:n,HTMLOptGroupElement:r,HTMLTextAreaElement:i}=this.document_.defaultView,s=Array.from(t).filter(this.filterUntranslatedNodes),d=[],c=[],h=(t,e,a)=>{if(!e)return;const n=this.trimWhitespace(e);this.verifyTextLine(n)&&(d.push(n),c.push({node:t,type:a,strippedBits:this.detectWhiteSpaces(e)}))};for(let t=0;t<s.length;t++){const o=s[t];if(!this.hasBannedParent(o)){if(h(o,o.title,"title"),o instanceof a)h(o,o.alt,"alt");else if(o instanceof n){h(o,o.placeholder,"placeholder");const{type:t}=o;"button"!==t&&"submit"!==t&&"reset"!==t||h(o,o.value,"value")}else o instanceof r?h(o,o.label,"label"):o instanceof i&&h(o,o.placeholder,"placeholder");[o.firstChild,o.nextSibling].forEach((t=>{let a=t;for(;a&&(!(a instanceof e)||!a.matches(l)||!this.filterUntranslatedNodes(a));){if(a.nodeType===Node.TEXT_NODE){const{nodeValue:t}=a,e=t.length>this.maxTextLength_?this.splitLines(t,this.maxTextLength_):t.length>1?[t]:[];for(let t=0;t<e.length;t++)h(a,e[t],"nodeValue")}a=a.nextSibling}}))}}return s.forEach((t=>t.setAttribute(o,""))),[d,c]}splitLines(t,e){const a=[];let n=0,r=e;for(;;){const e=t.indexOf(".",r);if(!(e>-1)){a.push(t.substr(n));break}{const i=t.substr(n,e-n+1);n+=i.length,r=e+1,a.push(i)}}return a}joinLines(t,e){let a=1;for(;a<t.length;)if(t[a-1].node===t[a].node&&t[a-1].type===t[a].type){t.splice(a,1);const[n]=e.translatedText.splice(a,1);e.translatedText[a-1]+=" "+n}else a++}verifyTextLine(t){if(t.length>1)for(let e=0;e<t.length;e++)if("?"!==t[e]&&"!"!==t[e]&&"."!==t[e])return!0;return!1}detectWhiteSpaces(t){let e=0;switch(t[0]){case" ":e|=c;break;case",":e|=T;break;case"。":case".":e|=g;break;case String.fromCharCode(160):e|=v}switch(t[t.length-1]){case" ":e|=h;break;case String.fromCharCode(160):e|=u}return e}restoreWhiteSpaces(t,e){return t&c&&" "!==e[0]&&(e=" "+e),t&h&&" "!==e[e.length-1]&&(e+=" "),t&v&&e[0]!==String.fromCharCode(160)&&(e=String.fromCharCode(160)+e),t&u&&e[e.length-1]!==String.fromCharCode(160)&&(e+=String.fromCharCode(160)),t&T&&","!==e[0]&&(e=", "+e),t&g&&"."!==e[e.length-1]&&"。"!==e[e.length-1]&&(e=". "+e),e}handleTranslationText(t,e){switch(e=this.restoreWhiteSpaces(t.strippedBits,e),t.type){case"alt":{const{node:a}=t;this.originalAlts.set(a,a.alt),a.alt=e;break}case"label":{const{node:a}=t;this.originalLabels.set(a,a.label),a.label=e;break}case"nodeValue":{const{node:a}=t;this.originalNodeValues.set(a,a.nodeValue),a.nodeValue=e;break}case"placeholder":{const{node:a}=t;this.originalPlaceholders.set(a,a.placeholder),a.placeholder=e;break}case"title":{const{node:a}=t;this.originalTitles.set(a,a.title),a.title=e;break}case"value":{const{node:a}=t;this.originalValues.set(a,a.value),a.value=e;break}}}setMaxTextLenForTesting=t=>{this.maxTextLength_=t};hasBannedParent(t){let{parentElement:e}=t,a=0;for(;e&&a<2;){if(d.includes(e.tagName))return!0;e=e.parentElement,a++}return!1}filterUntranslatedNodes=t=>{if("TITLE"===t.nodeName)return!0;const e="OPTION"===t.nodeName||"OPTGROUP"===t.nodeName?t.closest("SELECT")??t:t;return this.isElementPartiallyInViewport(e)};resetData(){this.isTranslated_=!1,this.document_.querySelectorAll("[data-vivaldi-translated]").forEach((t=>t.removeAttribute(o))),this.originalAlts.clear(),this.originalLabels.clear(),this.originalNodeValues.clear(),this.originalPlaceholders.clear(),this.originalTitles.clear(),this.originalValues.clear(),this.startTime_=0,this.endTime_=0}revertInternal(){window.requestAnimationFrame((()=>{for(const[t,e]of this.originalAlts)t.alt=e;for(const[t,e]of this.originalLabels)t.label=e;for(const[t,e]of this.originalNodeValues)t.nodeValue=e;for(const[t,e]of this.originalPlaceholders)t.placeholder=e;for(const[t,e]of this.originalTitles)t.title=e;for(const[t,e]of this.originalValues)t.value=e;this.resetData()}))}continueTranslateInternal(){this.isTranslated_&&(window.requestIdleCallback?window.requestAnimationFrame((()=>{window.requestIdleCallback((()=>this.startTranslateInternal(this.sourceLang_,this.targetLang_)),{timeout:100})})):window.requestAnimationFrame((()=>{this.startTranslateInternal(this.sourceLang_,this.targetLang_)})))}startTranslateInternal(t,e){const a=this.document_.querySelectorAll(l),[n,r]=this.processNodes(a);return this.sourceLang_=t,this.startServerConnectFunction_(t,e,n,this.overrideServer_,((t,a)=>{this.startTime_=t.startTime,this.endTime_=t.endTime,this.error_=t.error,this.errorCode_=t.errorCode,this.isTranslated_=!1===t.error,a&&a.translatedText&&(this.isTranslated_=!0,a.detectedSourceLanguage===e?console.warn("Translate: Detected source language '"+a.detectedSourceLanguage+"' identical to target language '"+e+"', not doing text replacement."):window.requestAnimationFrame((()=>{const e=performance.now();this.joinLines(r,a);for(let t=0;t<a.translatedText.length;t++)this.handleTranslationText(r[t],a.translatedText[t]);const i=performance.now();console.log("Translate server request of "+n.length.toString()+" texts took "+(t.endTime-t.startTime).toFixed(2)+" ms, processing: "+(i-e).toFixed(2)+" ms."),this.resultCallback?.()}))),this.observer.observe(document,{subtree:!0,childList:!0})})),!0}}window.vivaldiTranslate||(window.vivaldiTranslate=new m);const w={googleTranslate:{get translationTime(){return window.vivaldiTranslate.translationTime()},get readyTime(){return 0},get loadTime(){return 0}}};window.cr=w})();